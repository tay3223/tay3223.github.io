<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解资源平衡与二次调度机制 | 古寒飞</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="description" content="meta中的文字描述，用于SEO">
    
    <link rel="preload" href="/assets/css/0.styles.a17ef63e.css" as="style"><link rel="preload" href="/assets/js/app.fd839b10.js" as="script"><link rel="preload" href="/assets/js/2.2b9e394d.js" as="script"><link rel="preload" href="/assets/js/11.f966ca3e.js" as="script"><link rel="prefetch" href="/assets/js/10.fc7f5120.js"><link rel="prefetch" href="/assets/js/12.90e838cb.js"><link rel="prefetch" href="/assets/js/13.6ae89312.js"><link rel="prefetch" href="/assets/js/14.c58c6dd4.js"><link rel="prefetch" href="/assets/js/15.dbe3a329.js"><link rel="prefetch" href="/assets/js/16.0ebac1ec.js"><link rel="prefetch" href="/assets/js/17.ff4a660a.js"><link rel="prefetch" href="/assets/js/18.c17eddf4.js"><link rel="prefetch" href="/assets/js/19.c20452c9.js"><link rel="prefetch" href="/assets/js/20.96d4df4e.js"><link rel="prefetch" href="/assets/js/21.62b7f2a6.js"><link rel="prefetch" href="/assets/js/22.58603927.js"><link rel="prefetch" href="/assets/js/23.b1a61b34.js"><link rel="prefetch" href="/assets/js/24.baa79893.js"><link rel="prefetch" href="/assets/js/25.ab19d84e.js"><link rel="prefetch" href="/assets/js/26.9dc5536c.js"><link rel="prefetch" href="/assets/js/27.33b48cc0.js"><link rel="prefetch" href="/assets/js/28.3e367597.js"><link rel="prefetch" href="/assets/js/29.86454070.js"><link rel="prefetch" href="/assets/js/3.5d21b6bd.js"><link rel="prefetch" href="/assets/js/30.2d509b25.js"><link rel="prefetch" href="/assets/js/31.d279d3e7.js"><link rel="prefetch" href="/assets/js/32.6ef0b503.js"><link rel="prefetch" href="/assets/js/4.d8544a7c.js"><link rel="prefetch" href="/assets/js/5.3337d71b.js"><link rel="prefetch" href="/assets/js/6.661b1545.js"><link rel="prefetch" href="/assets/js/7.150e0099.js"><link rel="prefetch" href="/assets/js/8.6d301a46.js"><link rel="prefetch" href="/assets/js/9.2edb421e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a17ef63e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="古寒飞" class="logo"> <span class="site-name can-hide">古寒飞</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/opensource/pushgateway_client.html" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的文章" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的文章" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/kubernetes/安装部署.html" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/pages/prometheus/target_icmp.html" class="nav-link">
  Prometheus
</a></li><li class="dropdown-item"><!----> <a href="/pages/theory/node_load.html" class="nav-link">
  原理探索
</a></li><li class="dropdown-item"><!----> <a href="/pages/install/openvpn.html" class="nav-link">
  安装部署
</a></li><li class="dropdown-item"><!----> <a href="/pages/taycc/pypi.html" class="nav-link">
  杂七杂八
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术规范" class="dropdown-title"><span class="title">技术规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术规范" class="mobile-dropdown-title"><span class="title">技术规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CNI-0.4.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="官方文档" class="dropdown-title"><span class="title">官方文献</span> <span class="arrow down"></span></button> <button type="button" aria-label="官方文档" class="mobile-dropdown-title"><span class="title">官方文献</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.consul.io/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Consul
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/prometheus/latest/getting_started/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Prometheus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/practices/pushing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pushgateway
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/alerting/latest/alertmanager/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Alertmanager
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/guide/markdown.html#自定义容器" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>
          Kubernetes
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/opensource/pushgateway_client.html" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的文章" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的文章" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/kubernetes/安装部署.html" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/pages/prometheus/target_icmp.html" class="nav-link">
  Prometheus
</a></li><li class="dropdown-item"><!----> <a href="/pages/theory/node_load.html" class="nav-link">
  原理探索
</a></li><li class="dropdown-item"><!----> <a href="/pages/install/openvpn.html" class="nav-link">
  安装部署
</a></li><li class="dropdown-item"><!----> <a href="/pages/taycc/pypi.html" class="nav-link">
  杂七杂八
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术规范" class="dropdown-title"><span class="title">技术规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术规范" class="mobile-dropdown-title"><span class="title">技术规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CNI-0.4.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="官方文档" class="dropdown-title"><span class="title">官方文献</span> <span class="arrow down"></span></button> <button type="button" aria-label="官方文档" class="mobile-dropdown-title"><span class="title">官方文献</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.consul.io/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Consul
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/prometheus/latest/getting_started/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Prometheus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/practices/pushing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pushgateway
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/alerting/latest/alertmanager/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Alertmanager
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/guide/markdown.html#自定义容器" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>
          Kubernetes
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基本知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes/安装部署.html" class="sidebar-link">安装部署--准备工作</a></li><li><a href="/pages/kubernetes/安装部署2.html" class="sidebar-link">安装部署--Master节点</a></li><li><a href="/pages/kubernetes/安装部署3.html" class="sidebar-link">安装部署--Worker节点</a></li><li><a href="/pages/kubernetes/安装部署4.html" class="sidebar-link">安装部署--网络插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入理解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes/deployment调度原理.html" class="sidebar-link">Pod创建过程</a></li><li><a href="/pages/kubernetes/ResourceQoS.html" class="sidebar-link">深入理解Resource QoS机制</a></li><li><a href="/pages/kubernetes/descheduler.html" aria-current="page" class="active sidebar-link">深入理解资源平衡与二次调度机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/kubernetes/descheduler.html#要解决的问题" class="sidebar-link">要解决的问题</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/descheduler.html#原理探索" class="sidebar-link">原理探索</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/descheduler.html#最终方案" class="sidebar-link">最终方案</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/descheduler.html#deschduler使用教程" class="sidebar-link">DeSchduler使用教程</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/descheduler.html#自定义调度器-·-从哪里开始" class="sidebar-link">自定义调度器 · 从哪里开始？</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>问题记录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes/k8s-001.html" class="sidebar-link">k8s集群中Node磁盘爆满如何处理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深入理解资源平衡与二次调度机制"><a href="#深入理解资源平衡与二次调度机制" class="header-anchor">#</a> 深入理解资源平衡与二次调度机制</h1> <blockquote><p>作者平时也得工作和干活~，尽量在有空的时候不断的去更新该博客...</p> <p>如果有相关问题或反馈，可以加作者微信（微信号：SPE3SRU3STAY）</p></blockquote> <br> <div class="custom-block tip"><p class="custom-block-title">本文默认：</p> <p><code>您已经了解以下组件的“基本概念”和“常规用法”：</code></p> <ul><li>kube-apiserver</li> <li>kube-controller-manager</li> <li>kube-scheduler</li> <li>kube-proxy</li> <li>kubectl</li> <li>kubelet</li> <li>etcd</li></ul></div> <h2 id="要解决的问题"><a href="#要解决的问题" class="header-anchor">#</a> 要解决的问题</h2> <h4 id="与朋友闲聊时提起的内容"><a href="#与朋友闲聊时提起的内容" class="header-anchor">#</a> 与朋友闲聊时提起的内容：</h4> <blockquote><p>        互联网业务都会一个明显的波峰波谷，To C业务的波峰波谷会更加剧烈，波峰波谷可能会有两个数量级的一个差异。</p> <p>        当研发在波谷的时候进行一次发布，这时候就会触发容器的一次重新调度，比如像我这个服务有几十个 Pod 的，可能会有十多个 pod 调度到一台机器，因为这时候的机器的使用率很低，就是服务怎么调度其实都可以。</p> <p>        但是到了晚高峰的时候，我的每一个 pod 资源的使用率就上来的，CPU 使用高了，它的吞吐也高了，然后我这十个Pod都在同一个机器上，我这台机器就会出现一些资源的瓶颈。</p></blockquote> <h4 id="从中抽象出的问题"><a href="#从中抽象出的问题" class="header-anchor">#</a> 从中抽象出的问题：</h4> <blockquote><p>Node节点资源调度不均匀，<code>波峰</code>与<code>波谷</code>之间的访问量诧异巨大，导致各节点资源利用不均衡，高负载Pod扎堆聚集在几个特定的Node之上，从而<code>触发资源瓶颈</code>和<code>某些运维成本的增加</code>。</p></blockquote> <p>以上的这个问题该如何去解决？</p> <h2 id="原理探索"><a href="#原理探索" class="header-anchor">#</a> 原理探索</h2> <div class="custom-block warning"><p class="custom-block-title">解决思路：</p> <ul><li><p>kube-schduler调度器只能完成对Pod的<code>一次调度</code>。当Pod被调度到指定节点上之后，kube-scheduler就无法再次调度这个运行中的Pod。</p></li> <li><p>而我们想要的是<code>全时段</code>的对Pod的某种动态调度，以求来达到Node资源平衡利用的最终预期。（比如每10分钟重新调度一次，一天差不多调度144次）</p></li> <li><p>那是不是我们可以手动的去<code>杀死</code>某些Pod，来让这些Pod回归到kube-scheduler监听的<code>未调度Pod清单</code>中，触发kube-scheduler的二次调度。</p></li> <li><p>同时手动<code>杀死</code>的Pod时，我们是不是应该还得引入某种条件和策略；不能随意乱杀，要是能按照<code>某种策略或者条件</code>的去杀死指定的Pod，那么解决方案会不会更优美。</p></li> <li><p>接着利用<code>（Deployment或StatefulSets总是会维持一个期望数量Pod的特性）</code>拉起新的Pod，自然而然的让新Pod重走一遍kube-scheduler的<code>过滤链</code>和<code>打分链</code>，以便为新Pod重新寻找到一个<code>资源富裕的Node节点</code>，最终把Pod调度分配过去。</p></li> <li><p>最后一步，我们是不是可以把上面每一次<code>杀死</code>Pod的过程，设定为某种自动化，让它每10分钟去执行一次，完全解放我们的双手。</p></li></ul></div> <blockquote><p>调度器通过Kubernetes通过list-watch机制来发现集群中尚未被调度Node上的Pod，感兴趣的同学可以自行查阅相关概念。</p></blockquote> <p>基于以上的解决方案，我们可以得出来一些清晰的理论支撑：</p> <div class="custom-block tip"><p class="custom-block-title">理论支撑：</p> <ul><li><p>仅仅依赖kube-scheduler调度器无法<code>全时段</code>的动态调整Node资源利用率。</p></li> <li><p>我们必须引入<code>某种二次调度的概念</code>来实现对Pod资源的再调度，以求达成<code>全时段</code>内资源的动态调度与平衡。</p></li> <li><p>如果kube-scheduler自带调度策略不够用，我们可以开发<code>自定义调度器</code>来实现更加精细化的调度需求。</p></li></ul></div> <p>自定义调度器分为四大类：</p> <blockquote><p>分类一：<br>
直接clone官方的kube-scheduler来修改源码（不推荐）<br> <br><br>
分类二：<br>
单独开发一个调度程序，使其和kube-scheduler同时运行，可以指定Pod的spec.schedulerName属性，来让当前Pod选择遵从哪个调度器的调度指令。<br> <br><br>
分类三：<br>
使用Scheduler extender（调度程序扩展器），利用webhook去和上游调度程序兼容。<code>（kubernetes-1.16版本之后已经废弃）</code><br> <br><br>
分类四：<br>
通过调度框架（Scheduler Framework）在整个调度链路中追加扩展点，我个地方我自己的理解是：有点类似于Vue.js页面加载过程中的那种生命周期一样，我们可以利用Scheduler Framework框架，来对生命周期中指定的环节进行再加工。<code>（kubernetes-1.15之后引入，同时也废弃了上文中的&quot;调度程序扩展器&quot;的用法）</code></p></blockquote> <h2 id="最终方案"><a href="#最终方案" class="header-anchor">#</a> 最终方案</h2> <ul><li><p>波峰波谷之间的变化是随着<code>时间线</code>来变化的，因此不论是【kube-scheduler的调度策略】还是【自己开发的调度器】，本质上都无法做到动态调整，所以引入【二次调度】的机制就尤为重要。</p></li> <li><p>通过定时性的运行【二次调度】程序，去“杀死”那些Node节点上超过阈值的资源占用，然后利用kube-scheduler的重新调度，彻底实现Node资源的再平衡。</p></li> <li><p>在技术选型时，我们这里选择<code>DeScheduler工具</code>来实现以上问题的解决。</p></li></ul> <p><img src="https://img.taycc.com/picgo/%E4%BA%8C%E6%AC%A1%E8%B0%83%E5%BA%A6%E8%BF%87%E7%A8%8B-3.png" alt="二次调度过程-3"></p> <h2 id="deschduler使用教程"><a href="#deschduler使用教程" class="header-anchor">#</a> DeSchduler使用教程</h2> <p>略...<br> <code>（网上一搜一大堆）</code></p> <h2 id="自定义调度器-·-从哪里开始"><a href="#自定义调度器-·-从哪里开始" class="header-anchor">#</a> 自定义调度器 · 从哪里开始？</h2> <p>        有很多公司会去考虑开发<code>自定义调度器</code>来解决某些<code>精细化调度</code>的问题，那么我们应该从哪里开始入手进行开发呢？从上文中可以看出，整个<code>调度、二次调度</code>的闭环中，有<code>两个环节</code>都可以适当的插入一些自己开发的东西：</p> <div class="custom-block warning"><p class="custom-block-title">自定义开发的思考：</p> <p>环节一：<br>
从<code>Scheduler Framework（调度框架）</code>这个位置进行的开发：</p> <ul><li>可以扩展kube-scheduler的能力（固然这一部分运维成本会增加一些，但是长期来看是非常利好的，可以从粗放型调度向精细化型调度转变）。</li></ul> <br> <p>环节二：<br>
从<code>Descheduler（二次调度）</code>这个位置进行的开发：</p> <ul><li><p>从这个位置做开发，有一个误区：<code>就是建议不要去跟kube-scheduler抢夺调度能力</code></p></li> <li><p>我们可以自己开发一个【二次调度工具】，去判断当前哪些Node的利用率过高，或者集成上<code>Pod的亲和性调度</code>再或者兼容<code>污点容忍度</code>等等某些特性，去当做<code>“杀死”</code>Pod的某种阈值和依据；甚至不相信kube-apiserver中查询到的Node资源利用率，而是<code>自己对接Prometheus数据源实时抓取Node真实监控利用率</code>来当做判断依据都是可以的。</p></li> <li><p>把自己的开发产物定位在<code>仅仅只是判断Node的资源利用状态，可以对接QoS机制杀死指定Pod的工具</code>这个角色位置上。实际的调度还是由kube-scheduler去做，这样的综合运维成本会被压低很多。</p></li> <li><p>因为如果我们人为开发<code>自定义调度器</code>去抢夺kube-scheduler的调度能力的话，就必然要实现一条【过滤链】和【打分链】，这种开发、后期维护、版本兼容性、等等问题的持续性伤害，可能会让<code>运维综合成本</code>变得很痛苦。</p></li></ul></div> <p>上面这个问题涉及到<code>综合运维成本</code>，可能作者的想法也不太正确，视角有所缺失等等，算作是抛砖引玉，期待着和大家一起交流和探讨，更欢迎大佬多多批评和指正~。</p> <blockquote><p>（全文到此结束）</p></blockquote> <p><br><br><br></p><hr><br><br><br><p></p> <h4 id="帮助作者改进文档"><a href="#帮助作者改进文档" class="header-anchor">#</a> 帮助作者改进文档</h4> <p>如果您喜欢这篇文档，想让它变得更好，您可以：</p> <ul><li>推荐这篇文档，让更多的人知道。</li> <li>给作者反馈和建议：<em><em><a href="mailto:tianye3223@gmail.com">tianye3223@gmail.com</a></em></em></li></ul> <p><br><br><br><br><br></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/kubernetes/ResourceQoS.html" class="prev">
        深入理解Resource QoS机制
      </a></span> <span class="next"><a href="/pages/kubernetes/k8s-001.html">
        k8s集群中Node磁盘爆满如何处理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.fd839b10.js" defer></script><script src="/assets/js/2.2b9e394d.js" defer></script><script src="/assets/js/11.f966ca3e.js" defer></script>
  </body>
</html>
