<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解Resource QoS | 古寒飞</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="description" content="meta中的文字描述，用于SEO">
    
    <link rel="preload" href="/assets/css/0.styles.a17ef63e.css" as="style"><link rel="preload" href="/assets/js/app.fd839b10.js" as="script"><link rel="preload" href="/assets/js/2.2b9e394d.js" as="script"><link rel="preload" href="/assets/js/9.2edb421e.js" as="script"><link rel="prefetch" href="/assets/js/10.fc7f5120.js"><link rel="prefetch" href="/assets/js/11.f966ca3e.js"><link rel="prefetch" href="/assets/js/12.90e838cb.js"><link rel="prefetch" href="/assets/js/13.6ae89312.js"><link rel="prefetch" href="/assets/js/14.c58c6dd4.js"><link rel="prefetch" href="/assets/js/15.dbe3a329.js"><link rel="prefetch" href="/assets/js/16.0ebac1ec.js"><link rel="prefetch" href="/assets/js/17.ff4a660a.js"><link rel="prefetch" href="/assets/js/18.c17eddf4.js"><link rel="prefetch" href="/assets/js/19.c20452c9.js"><link rel="prefetch" href="/assets/js/20.96d4df4e.js"><link rel="prefetch" href="/assets/js/21.62b7f2a6.js"><link rel="prefetch" href="/assets/js/22.58603927.js"><link rel="prefetch" href="/assets/js/23.b1a61b34.js"><link rel="prefetch" href="/assets/js/24.baa79893.js"><link rel="prefetch" href="/assets/js/25.ab19d84e.js"><link rel="prefetch" href="/assets/js/26.9dc5536c.js"><link rel="prefetch" href="/assets/js/27.33b48cc0.js"><link rel="prefetch" href="/assets/js/28.3e367597.js"><link rel="prefetch" href="/assets/js/29.86454070.js"><link rel="prefetch" href="/assets/js/3.5d21b6bd.js"><link rel="prefetch" href="/assets/js/30.2d509b25.js"><link rel="prefetch" href="/assets/js/31.d279d3e7.js"><link rel="prefetch" href="/assets/js/32.6ef0b503.js"><link rel="prefetch" href="/assets/js/4.d8544a7c.js"><link rel="prefetch" href="/assets/js/5.3337d71b.js"><link rel="prefetch" href="/assets/js/6.661b1545.js"><link rel="prefetch" href="/assets/js/7.150e0099.js"><link rel="prefetch" href="/assets/js/8.6d301a46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a17ef63e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="古寒飞" class="logo"> <span class="site-name can-hide">古寒飞</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/opensource/pushgateway_client.html" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的文章" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的文章" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/kubernetes/安装部署.html" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/pages/prometheus/target_icmp.html" class="nav-link">
  Prometheus
</a></li><li class="dropdown-item"><!----> <a href="/pages/theory/node_load.html" class="nav-link">
  原理探索
</a></li><li class="dropdown-item"><!----> <a href="/pages/install/openvpn.html" class="nav-link">
  安装部署
</a></li><li class="dropdown-item"><!----> <a href="/pages/taycc/pypi.html" class="nav-link">
  杂七杂八
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术规范" class="dropdown-title"><span class="title">技术规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术规范" class="mobile-dropdown-title"><span class="title">技术规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CNI-0.4.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="官方文档" class="dropdown-title"><span class="title">官方文献</span> <span class="arrow down"></span></button> <button type="button" aria-label="官方文档" class="mobile-dropdown-title"><span class="title">官方文献</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.consul.io/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Consul
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/prometheus/latest/getting_started/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Prometheus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/practices/pushing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pushgateway
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/alerting/latest/alertmanager/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Alertmanager
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/guide/markdown.html#自定义容器" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>
          Kubernetes
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/opensource/pushgateway_client.html" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的文章" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的文章" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/kubernetes/安装部署.html" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/pages/prometheus/target_icmp.html" class="nav-link">
  Prometheus
</a></li><li class="dropdown-item"><!----> <a href="/pages/theory/node_load.html" class="nav-link">
  原理探索
</a></li><li class="dropdown-item"><!----> <a href="/pages/install/openvpn.html" class="nav-link">
  安装部署
</a></li><li class="dropdown-item"><!----> <a href="/pages/taycc/pypi.html" class="nav-link">
  杂七杂八
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术规范" class="dropdown-title"><span class="title">技术规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术规范" class="mobile-dropdown-title"><span class="title">技术规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/containernetworking/cni/blob/spec-v0.4.0/SPEC.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CNI-0.4.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="官方文档" class="dropdown-title"><span class="title">官方文献</span> <span class="arrow down"></span></button> <button type="button" aria-label="官方文档" class="mobile-dropdown-title"><span class="title">官方文献</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.consul.io/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Consul
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/prometheus/latest/getting_started/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Prometheus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/practices/pushing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pushgateway
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://prometheus.io/docs/alerting/latest/alertmanager/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Alertmanager
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/guide/markdown.html#自定义容器" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><h4>
          Kubernetes
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基本知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes/安装部署.html" class="sidebar-link">安装部署--准备工作</a></li><li><a href="/pages/kubernetes/安装部署2.html" class="sidebar-link">安装部署--Master节点</a></li><li><a href="/pages/kubernetes/安装部署3.html" class="sidebar-link">安装部署--Worker节点</a></li><li><a href="/pages/kubernetes/安装部署4.html" class="sidebar-link">安装部署--网络插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入理解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes/deployment调度原理.html" class="sidebar-link">Pod创建过程</a></li><li><a href="/pages/kubernetes/ResourceQoS.html" aria-current="page" class="active sidebar-link">深入理解Resource QoS机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/kubernetes/ResourceQoS.html#什么是requests和limits" class="sidebar-link">什么是Requests和Limits</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/ResourceQoS.html#超售机制" class="sidebar-link">超售机制</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/ResourceQoS.html#限制机制" class="sidebar-link">限制机制</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/ResourceQoS.html#对调度策略的影响" class="sidebar-link">对调度策略的影响</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes/ResourceQoS.html#服务质量等级-qos-classes" class="sidebar-link">服务质量等级（QoS Classes）</a></li></ul></li><li><a href="/pages/kubernetes/descheduler.html" class="sidebar-link">深入理解资源平衡与二次调度机制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>问题记录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes/k8s-001.html" class="sidebar-link">k8s集群中Node磁盘爆满如何处理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深入理解resource-qos"><a href="#深入理解resource-qos" class="header-anchor">#</a> 深入理解Resource QoS</h1> <blockquote><p>作者平时也得工作和干活~，尽量在有空的时候不断的去更新该博客...</p> <p>如果有相关问题或反馈，可以加作者微信（微信号：SPE3SRU3STAY）</p></blockquote> <br> <div class="custom-block warning"><p class="custom-block-title">学习中的疑问：</p> <p>Kubernetes是如何根据Pod的<code>Requests配置和Limits配置</code>，来实现针对Pod的资源服务质量控制（QoS）的呢，这个过程中都发生了什么？</p></div> <h2 id="什么是requests和limits"><a href="#什么是requests和limits" class="header-anchor">#</a> 什么是Requests和Limits</h2> <p>在Kubernetes的QoS体系中，需要保证高可靠的Pod可以申请<code>可靠资源</code>，而一些非高可靠性的Pod可以申请<code>可靠性较低</code>或<code>不可靠</code>的资源。</p> <p>Pod容器资源的配置分为Requests和Limits。</p> <ul><li>Requests：是Kubernetes调度时能为容器提供可保证的资源量（最低保障）。</li> <li>Limits：是系统允许容器运行时可能使用的资源量的上限（最高上限）。</li></ul> <div class="custom-block tip"><p class="custom-block-title">小提示：</p> <p>Pod级别的资源配置是通过计算Pod内<code>所有容器资源配置</code>的总和得出来的。</p></div> <h2 id="超售机制"><a href="#超售机制" class="header-anchor">#</a> 超售机制</h2> <p>Kubernetes中Pod的Requests和Limits资源配置有如下特点：</p> <ul><li><p>如果Pod配置的Requests值<code>等于</code>Limits值，那么该Pod可以获得的资源是<code>完全可靠</code>的。</p></li> <li><p>如果Pod的Requests值<code>小于</code>Limits值，那么该Pod获得资源可以分为两个部分关注：</p> <ul><li><p><code>完全可靠的资源</code>，资源量的大小等于Requests值；</p></li> <li><p><code>不可靠的资源</code>，资源量最大等于Limits与Requests的差额，这份不可靠的资源能够申请多少，取决于当时主机上容器可用资源的余量。</p></li></ul></li></ul> <p>通过这种机制，Kubernetes可以实现节点资源的超售（Over Subscription），例如：</p> <details class="custom-block details"><summary>点击查看示例</summary> <ul><li>在CPU完全充足的情况下，某机器共有32GiB内存可供容器使用。</li> <li>将一个容器的Requests值为1GiB、Limits值为2GiB。</li> <li>那么在该机器上最多可以同时运行32个容器，每个容器最多可以使用2GiB内存。</li> <li>如果这些容器的<code>内存使用峰值</code>能错开，那么所有容器都可以正常运行。</li></ul></details> <p>超售机制能有效提高资源的利用率，也不会影响容器申请的<code>完全可靠资源</code>的可靠性.</p> <h2 id="限制机制"><a href="#限制机制" class="header-anchor">#</a> 限制机制</h2> <p>Requests和Limits对不同计算资源类型的限制机制</p> <p>根据上文的内容可知，容器的资源配置满足以下两个条件：</p> <div class="custom-block warning"><p class="custom-block-title">核心条件：</p> <ul><li>Requests &lt;= 节点可用资源</li> <li>Requests &lt;= Limits</li></ul></div> <p>Kubernetes根据Pod配置的Requests值来调度Pod，Pod在成功调度之后会得到Requests值定义的资源来运行；如果Pod所在机器上的资源有空余，则Pod可以申请更多的资源，最多不能超过Limits的值。</p> <p>下面看一下Requests和Limits针对不同计算资源类型的<code>限制机制</code>的有什么差异，这种差异主要取决于计算资源类型是<code>可压缩资源</code>还是<code>不可压缩资源</code>。</p> <h3 id="可压缩资源"><a href="#可压缩资源" class="header-anchor">#</a> 可压缩资源</h3> <p>Kubernetes目前支持的可压缩资源是CPU。</p> <p>Pod可以得到Requests配置的CPU使用量，而使用超过Requests值的部分取决于<code>系统的负载和调度</code>。</p> <blockquote><p>不过由于目前Kubernetes和Docker的CPU隔离机制都是在容器级别起作用的，所以Pod级别的资源配置并不能完全得到保障；Pod级别的cgroup正在紧锣密鼓的开发中，如果将来引入，就可以确保Pod级别的资源配置准确运行。</p></blockquote> <p>空闲的CPU资源按照容器Requests值的比例分配。举例说明：</p> <ul><li>容器A的CPU配置为<code>Requests 1</code>、<code>Limits 10</code></li> <li>容器B的CPU配置为<code>Requests 2</code>、<code>Limits 8</code></li></ul> <details class="custom-block details"><summary>点击查看示例</summary> <blockquote><p>A和B同时运行在一个节点上，初始状态下容器的可用CPU为<code>3 cores</code>，那么A和B恰好得到在其Requests中定义的CPU用量，即1CPU和2CPU。<br>
~<br>
如果A和B都需要更多的CPU资源，而恰好此时系统的其它任务释放了1.5CPU，那么这1.5CPU将按照A和B的Requests值的比例<code>1:2</code>分配给A和B，即最终A可以使用1.5CPU，B可以使用3CPU。<br>
~<br>
如果A的CPU用量超过了<code>Limits 10</code>的配置用量，那么cgroups会对Pod中容器的CPU用量进行限流（Throttled）。<br>
~<br>
如果A的CPU用量没有配置<code>Limits 10</code>的限制，那么A回去尝试抢占所有空闲的CPU资源（Kubernetes从1.2版本开始，默认开启--cpu-cfs-quota参数，因此在默认情况下必须配置Limits）。</p></blockquote></details> <h3 id="不可压缩资源"><a href="#不可压缩资源" class="header-anchor">#</a> 不可压缩资源</h3> <p>Kubernetes目前支持的不可压缩资源是内存。</p> <p>Pod可以得到在Requests中配置的内存。</p> <p>如果Pod的内存用量小于它的Requests的配置，那么这个Pod可以正常运行（除非出现炒作系统级别内存不足等严重问题）；如果Pod的内存容量超过了它的Requests配置，那么这个Pod有可能被Kubernetes “杀掉”。</p> <details class="custom-block details"><summary>点击查看示例</summary> <blockquote><p>比如PodA使用了超过Requests而不到Limits的内存量，此时同一机器上另一个PodB之前只使用了远少于自己的Requests值的内存，此时程序压力增大，PodB向系统申请的总量不超过自己的Requests值的内存，那么Kubernetes可能会直接 “杀掉” PodA。<br>
~<br>
另外一种情况是PodA使用了超过Requests而不到Limits的内存，此时Kubernetes将一个新的Pod调度到这台机器上，新的Pod需要使用内存，而只有PodA使用了超过了自己Requests值的内存，那么Kubernetes也可能会 “杀掉” PodA来释放内存资源。</p></blockquote></details> <p>如果有Pod的内存用量超过了它Limits设置，那么操作系统内核会 “杀掉” Pod所有容器的所有进程中<code>内存使用量最多</code>的一个，直到内存不超过Limits时为止。</p> <h2 id="对调度策略的影响"><a href="#对调度策略的影响" class="header-anchor">#</a> 对调度策略的影响</h2> <ul><li>Kubernetes的kube-scheduler通过计算Pod中所有容器的Requests的总和来决定对Pod的调度。</li> <li>不管是CPU还是内存，Kubernetes调度器和Kubelet节点代理都会确保节点上所有Pod的Requests总和不会超过在该节点上可分配给容器使用的资源容量上线。</li></ul> <h2 id="服务质量等级-qos-classes"><a href="#服务质量等级-qos-classes" class="header-anchor">#</a> 服务质量等级（QoS Classes）</h2> <p>在一个超用（Over Committed，容器Limits总和大于系统容量上线）的系统中，容器负载的波动可能导致操作系统的资源不足，最终导致部分容器被 “杀掉”。</p> <p>在这种情况下，我们当然会希望优先 “杀掉” 那些不太重要的容器，那么如何平衡重要程度呢？</p> <p>Kubernetes量容器划分成3个QoS等级：</p> <ul><li>Guaranteed（完全可靠）</li> <li>Burstable（弹性波动、较可靠的）</li> <li>BestEffort（尽力而为、不太可靠的）</li></ul> <p>从理论上来说，QoS级别应该做为一个单独的参数来提供API，并由用户对Pod进行配置，这种配置应该与Requests和Limits无关。</p> <p>但在当前版本的Kubernetes设计中，为了简化模式及避免引入太多的复杂性，QoS级别直接由Requests和Limits定义。</p> <p>在Kubernetes中，容器的QoS级别等于容器所在Pod的QoS级别，而Kubernetes的资源配置定了Pod的三种QoS级别：</p> <div class="custom-block danger"><p class="custom-block-title">三大分类：</p> <ul><li>Guaranteed</li></ul> <blockquote><p>如果Pod中的所有容器对所有资源类型都定义了Requests和Limits，并且所有容器的Requests和Limits的值都相等（且都不为0），那么该Pod的QoS级别就是Guaranteed。</p></blockquote> <ul><li>BestEffort</li></ul> <blockquote><p>如果Pod中所有容器都未定义资源配置（Requests和Limits都未定义），那么该Pod的QoS级别就是BestEffort。</p></blockquote> <ul><li>Burstable</li></ul> <blockquote><p>当一个Pod即不为<code>Guaranteed级别</code>，也不为<code>BestEffort级别</code>时，该Pod的QoS级别就是Burstable。Burstable级别的Pod涉及两种情况：</p> <ul><li>第一种情况：Pod中的一部分容器在一种或多种资源类型的资源配置中定义了Requests值和Limits值（都不为0），且Requests值小于Limits值。<br>
~</li> <li>第二种情况：Pod中的一部分容器未定义资源配置（Requests和Limits都未定义）。注意：在容器未定义Limits时，Limits值默认等于节点资源容量的上限。</li></ul></blockquote></div> <h3 id="kubernetes-qos的工作特点"><a href="#kubernetes-qos的工作特点" class="header-anchor">#</a> Kubernetes QoS的工作特点</h3> <p>在Pod的CPU Requests无法得到满足（比如节点的系统级任务占用过多CPU，导致无法分配足够的CPU给容器使用）时，容器得到的CPU会被压缩限流。</p> <p>由于内存是不可压缩的资源，所以针对内存资源紧缺的情况，会按照以下逻辑处理。</p> <p>（1） BestEffort Pod的优先级最低，在这类Pod中运行的进程会在系统内存紧缺时被第一优先级 “杀掉”。当然，从另一个角度来看，BestEffort Pod由于没有设置资源Limits，所以在资源充足时，他们可以充分使用所有闲置资源。</p> <p>（2） Burstable Pod的优先级居中，这类Pod在初始时会被分配较少的可靠资源，但可以按需申请更多的资源。当然，如果整个系统内存紧缺，🈶没有BestEffort容器可以被杀掉以释放资源，那么这类Pod中的进程可能被 “杀掉” 。</p> <p>（3）Guaranteed Pod的优先级最高，而且一般情况下这类Pod只要不超过其资源Limits的限制就不会被 “杀掉”。当然，如果整个系统内存紧缺，又没有其它更低优先级的容器可以被 “杀掉” 以释放资源，那么这类Pod中的进程也可能会被 “杀掉”。</p> <h3 id="oom计分规则"><a href="#oom计分规则" class="header-anchor">#</a> OOM计分规则</h3> <p>OOM（Out Of Memory）积分规则包括如下内容：</p> <ul><li>OOM积分的计算方法：</li></ul> <div class="custom-block warning"><p class="custom-block-title">计算方法</p> <ul><li>计算进程所使用的的内存在系统中所占的百分比，取其中不含百分号的数值，再乘以10，该结果是进程OOM的基础分。</li> <li></li> <li>讲进程OOM基础分的分值再加上这个进程的oom_SCORE_ADJ（分数调整）值，做为进程OOM的最终分值（除root启动的进程外）。</li> <li></li> <li>在系统发生OOM时，OOM Killer会优先“杀掉”OOM计分更高的进程.</li></ul></div> <ul><li><p>进程的OOM计分的基本分数值范围是0~1000，如果A进程的调整至OOM_SCORE_ADJ减去B进程的调整值的结果大于1000，那么A进程的OOM计分最终值必然大于B进程，会有限“杀掉”A进程。</p></li> <li><p>不论调整OOM_SCORE_ADJ值为多少，任何进程的最终分值范围也是0~1000。</p></li></ul> <table><thead><tr><th>QoS等级</th> <th>oom_score_adj</th></tr></thead> <tbody><tr><td>Guaranteed</td> <td>-998</td></tr> <tr><td>Burstable</td> <td>min(max(1,1000-(1000*memoryRequestBytes)/machineMemoryCapacityBytes),999)</td></tr> <tr><td>BestEffort</td> <td>1000</td></tr></tbody></table> <p>对表中的内容说明如下：</p> <details class="custom-block details"><summary>点击查看说明详情</summary> <ul><li><p>BestEffort Pod设置OOM_SCORE_ADJ调整值为1000，因此BestEffort Pod中容器里所有进程的OOM最终分肯定是1000.</p></li> <li><p>Guaranteed Pod设置OOM_SCORT_ADJ调整值为-998，因此Guaranteed POd中容器里所有进程的OOM最终分一般是0或1（因为基础分不可能是1000）。</p></li> <li><p>对Burstable Pod规则分情况说明：</p> <ul><li>如果Burstable Pod的内存Requests超过系统可用内存的99.8%，那么这个Pod的OOM_SCORE_ADJ调整值固定为2；</li> <li>否则，设置OOM_SCORE_ADJ调整值为<code>1000-10*(% of memory requested)</code>；</li> <li>如果内容Requests为0，那么OOM__SCORE_ADJ调整值固定为999.</li> <li>这样的规则能确保OOM_SCORE_ADJ调整值的范围为2~999，而Burstable Pod中所有进程的OOM最终分数范围为2~1000.</li> <li>Burstable Pod进程的OOM最终分数始终大于Cuaranteed Pod的进程得分，因此他们会被优先“杀掉”。</li> <li>如果一个Burstable Pod使用的内存比他的内存Requests少，那么可以肯定的事，他的所有进程的OOM最终分数会小于1000，此时能确保它的优先级高于BestEffort Pod。</li> <li>如果在一个Burstable Pod的某个容器中某个进程使用的内存比容器的Requests值高，那么这个进程的OOM最终分数就会是1000，否则他的OOM最终分数会小于1000。</li> <li>假设在下面的容器中有一个占用内存非常大的进程，那么当一个使用内存超过其Requests的Burstable Pod与另外一个使用内存少于其Requests的Burstable Pod发生内存竞争冲突时，前者的进程会被系统“杀掉”。</li> <li>如果在一个Burstable Pod内部有多个进程的多个容器发生内存竞争冲突，那么此时OOM评分只能做为参考，不能保证完全按照资源配置的定义来执行OOM Kill。</li></ul></li> <li><p>OOM还有一些特殊的计分规则：</p> <ul><li>kubelet进程和Docker进程的调整值OOM_SOCRE_ADJ始终为-998。</li> <li>如果配置进程调整值OOM_SCORE_ADJ为-999，那么这类进程不会被OOM Killer“杀掉”。</li></ul></li></ul></details> <h3 id="qos的演进"><a href="#qos的演进" class="header-anchor">#</a> QoS的演进</h3> <p>目前Kubernetes基于QoS的潮涌机制日趋完善，但还有一些限制。</p> <div class="custom-block tip"><p class="custom-block-title">不足之处</p> <ul><li>不支持内存Swap，当前的QoS策略都假定了主机不启动内存swap，Kubernetes从1.8版本开始默认关闭Swap特性，如果主机启动了Swap功能，上面的QoS策略就可能失效。</li> <li></li> <li>缺乏更丰富的QoS策略，当前的QoS策略都是基于Pod的（Requests和Limits）来定义的。社区有考虑过引入自定义QoS的功能，但是这一块目前还不太明朗，等待后续持续关注了解清楚后再进行内容的追加。</li></ul></div> <blockquote><p>（到此为止，Resource QoS 原理分析完毕）</p></blockquote> <p><br><br><br></p><hr><br><br><br><p></p> <h4 id="帮助作者改进文档"><a href="#帮助作者改进文档" class="header-anchor">#</a> 帮助作者改进文档</h4> <p>如果您喜欢这篇文档，想让它变得更好，您可以：</p> <ul><li>推荐这篇文档，让更多的人知道。</li> <li>给作者反馈和建议：<em><em><a href="mailto:tianye3223@gmail.com">tianye3223@gmail.com</a></em></em></li></ul> <p><br><br><br><br><br></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/kubernetes/deployment调度原理.html" class="prev">
        Pod创建过程
      </a></span> <span class="next"><a href="/pages/kubernetes/descheduler.html">
        深入理解资源平衡与二次调度机制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.fd839b10.js" defer></script><script src="/assets/js/2.2b9e394d.js" defer></script><script src="/assets/js/9.2edb421e.js" defer></script>
  </body>
</html>
